#!/usr/bin/env ruby
# requires IAM role/Environment variables for aws auth
require 'stellar-core-backup'
require 'optparse'
#require 'tracer'

options = { verify: 'V'}

OptionParser.new do |opts|
  opts.banner = "Usage: #{$0} [options]"
  opts.on("-b", "--backup", "cold backup stellar-core") do |b|
    options[:type] = 'backup'
  end
  opts.on("-c CONFIG", "--config", "configuration file to use") do |c|
    options[:config] = c
  end
  opts.on("-l", "--list", "list all backups") do |l|
    options[:list] = l
  end
  opts.on("-r", "--restore", "offline restore, uses latest backup") do |r|
    options[:type] = 'restore'
  end
  opts.on("-R", "--rm", "auto-clean buckets directory") do |r|
    options[:clean] = 'R'
  end
  opts.on("--no-verify", "Don't PGP sign backed up shasum file or verify restore files integrity (default on)") do |r|
    options.delete(:verify)
  end
  opts.on("-d", "--debug", "dump debug output") do |r|
    $debug = 'on'
  end
end.parse!

#Tracer.on

if ! options[:type]
  puts("No operation specified\nExitting\n")
else
  scb = StellarCoreBackup::Job.new(options)
  scb.run()
end

exit

